<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MarginIQ Â· Enterprise AI Pricing Committee</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:wght@400;500&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
/* â”€â”€â”€ ROOT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
:root{
  --bg:#05080E;--bg2:#0A0F1C;--bg3:#0F1626;
  --surf:#131C2E;--surf2:#1A243A;
  --bdr:#1E2D47;--bdr2:#273A58;
  --blue:#1B6EF3;--blue2:#3B82F6;--teal:#06B6D4;
  --green:#10B981;--amber:#F59E0B;--red:#EF4444;
  --white:#EEF2FF;--muted:#5A6E8A;--dim:#8898B0;--text:#C4CFE2;
  --gdim:rgba(16,185,129,.12);--adim:rgba(245,158,11,.12);
  --rdim:rgba(239,68,68,.12);--bdim:rgba(27,110,243,.14);
  --r:10px;--rl:14px;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%;overflow:hidden}
body{font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--text);font-size:13px;line-height:1.5}
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--bdr2);border-radius:4px}

/* â”€â”€â”€ TOPBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#topbar{
  position:fixed;top:0;left:0;right:0;z-index:200;
  height:54px;
  background:rgba(5,8,14,.95);
  backdrop-filter:blur(20px);
  border-bottom:1px solid var(--bdr);
  display:flex;align-items:center;justify-content:space-between;
  padding:0 20px;
  gap:12px;
}
.tb-brand{display:flex;align-items:center;gap:10px;flex-shrink:0}
.tb-logo{width:32px;height:32px;background:linear-gradient(135deg,var(--blue),var(--teal));border-radius:8px;display:flex;align-items:center;justify-content:center;font-family:'DM Mono',monospace;font-size:10px;font-weight:500;color:#fff;flex-shrink:0;letter-spacing:-.5px}
.tb-name{font-family:'Syne',sans-serif;font-size:16px;font-weight:800;color:var(--white);letter-spacing:-.3px}
.tb-sub{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);letter-spacing:.3px;margin-top:1px}
.tb-right{display:flex;align-items:center;gap:10px;flex-shrink:0}
.live-pill{display:flex;align-items:center;gap:5px;background:var(--gdim);border:1px solid rgba(16,185,129,.25);padding:4px 11px;border-radius:100px;font-family:'DM Mono',monospace;font-size:9px;color:var(--green);white-space:nowrap}
.live-dot{width:5px;height:5px;background:var(--green);border-radius:50%;animation:blink 2s infinite;flex-shrink:0}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
.tb-btn{padding:5px 13px;border-radius:7px;cursor:pointer;font-family:'DM Mono',monospace;font-size:9px;white-space:nowrap;transition:all .15s;border:1px solid var(--bdr2);background:var(--surf2);color:var(--dim)}
.tb-btn:hover{color:var(--white);border-color:var(--bdr)}
.tb-btn-ai{background:linear-gradient(135deg,var(--blue),var(--teal));border:none;color:#fff;font-weight:500}
.tb-btn-ai:hover{opacity:.85;transform:translateY(-1px)}

/* â”€â”€â”€ APP SHELL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#app{
  position:fixed;
  top:54px;left:0;right:0;bottom:0;
  display:flex;
  overflow:hidden;
}

/* â”€â”€â”€ SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#sidebar{
  width:220px;
  flex-shrink:0;
  background:var(--bg2);
  border-right:1px solid var(--bdr);
  overflow-y:auto;
  padding:10px 0 20px;
  height:100%;
}
.sn-label{font-family:'DM Mono',monospace;font-size:8px;color:var(--muted);letter-spacing:1.5px;text-transform:uppercase;padding:14px 18px 5px}
.sn-item{display:flex;align-items:center;gap:9px;padding:8px 18px;cursor:pointer;border-left:2px solid transparent;transition:all .15s;font-size:12px;color:var(--dim)}
.sn-item:hover{color:var(--white);background:rgba(255,255,255,.03)}
.sn-item.on{color:var(--blue2);border-left-color:var(--blue);background:var(--bdim);font-weight:500}
.sn-icon{font-size:13px;width:16px;text-align:center;flex-shrink:0}
.sn-badge{margin-left:auto;background:var(--red);color:#fff;font-family:'DM Mono',monospace;font-size:8px;padding:1px 5px;border-radius:100px}
.sn-num{margin-left:auto;font-family:'DM Mono',monospace;font-size:8px;color:var(--muted);background:var(--bg3);border:1px solid var(--bdr);width:16px;height:16px;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.sn-item.on .sn-num{background:var(--blue);color:#fff;border-color:var(--blue)}
.sn-divider{height:1px;background:var(--bdr);margin:6px 18px}

/* â”€â”€â”€ MAIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#main{
  flex:1;
  overflow-y:auto;
  overflow-x:hidden;
  padding:24px 28px;
  height:100%;
  min-width:0;
}

/* â”€â”€â”€ SCREENS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.screen{display:none;flex-direction:column;gap:18px;animation:fadeUp .25s ease}
.screen.on{display:flex}
@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

/* â”€â”€â”€ PAGE HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.ph{display:flex;align-items:flex-start;justify-content:space-between;flex-wrap:wrap;gap:8px;margin-bottom:4px}
.ph-title{font-family:'Syne',sans-serif;font-size:20px;font-weight:800;color:var(--white);letter-spacing:-.4px;line-height:1.15}
.ph-sub{font-size:12px;color:var(--dim);margin-top:3px}
.ph-tag{font-family:'DM Mono',monospace;font-size:9px;letter-spacing:.4px;padding:4px 12px;border-radius:6px;border:1px solid var(--bdr2);color:var(--muted);align-self:flex-start;white-space:nowrap;flex-shrink:0}

/* â”€â”€â”€ CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.card{background:var(--surf);border:1px solid var(--bdr);border-radius:var(--rl);overflow:hidden}
.card-hd{padding:12px 18px;border-bottom:1px solid var(--bdr);display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
.card-title{font-family:'Syne',sans-serif;font-size:13px;font-weight:700;color:var(--white)}
.card-body{padding:18px}
.card-body.np{padding:0}

/* â”€â”€â”€ GRIDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.g2{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.g3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
.g4{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}

/* â”€â”€â”€ KPI TILES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.kpi{background:var(--surf);border:1px solid var(--bdr);border-radius:var(--rl);padding:16px 18px;position:relative;overflow:hidden}
.kpi::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--blue),var(--teal))}
.kpi.g::before{background:linear-gradient(90deg,var(--green),var(--teal))}
.kpi.a::before{background:linear-gradient(90deg,var(--amber),#F97316)}
.kpi.r::before{background:linear-gradient(90deg,var(--red),#DB2777)}
.kpi-lbl{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);letter-spacing:.7px;text-transform:uppercase;margin-bottom:6px}
.kpi-val{font-family:'Syne',sans-serif;font-size:26px;font-weight:800;color:var(--white);letter-spacing:-1px;line-height:1}
.kpi-dt{font-family:'DM Mono',monospace;font-size:10px;margin-top:5px}
.kpi-dt.up{color:var(--green)}.kpi-dt.dn{color:var(--red)}.kpi-dt.neu{color:var(--dim)}

/* â”€â”€â”€ BADGES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.badge{display:inline-flex;align-items:center;gap:3px;padding:2px 9px;border-radius:100px;font-family:'DM Mono',monospace;font-size:9px;font-weight:500;white-space:nowrap;flex-shrink:0}
.bg{background:var(--gdim);color:var(--green);border:1px solid rgba(16,185,129,.2)}
.ba{background:var(--adim);color:var(--amber);border:1px solid rgba(245,158,11,.2)}
.br{background:var(--rdim);color:var(--red);border:1px solid rgba(239,68,68,.2)}
.bb{background:var(--bdim);color:var(--blue2);border:1px solid rgba(59,130,246,.2)}
.bm{background:rgba(90,110,138,.1);color:var(--dim);border:1px solid rgba(90,110,138,.2)}

/* â”€â”€â”€ BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.btn{padding:8px 16px;border-radius:8px;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:12px;font-weight:600;border:none;transition:all .15s;display:inline-flex;align-items:center;gap:6px;white-space:nowrap}
.btn-g{background:var(--green);color:#fff}.btn-g:hover{opacity:.85}
.btn-a{background:var(--amber);color:#000}.btn-a:hover{opacity:.85}
.btn-r{background:var(--red);color:#fff}.btn-r:hover{opacity:.85}
.btn-blue{background:var(--blue);color:#fff}.btn-blue:hover{opacity:.85}
.btn-ghost{background:var(--surf2);color:var(--text);border:1px solid var(--bdr2)}.btn-ghost:hover{border-color:var(--blue2);color:var(--white)}

/* â”€â”€â”€ TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
table{width:100%;border-collapse:collapse}
thead tr{background:var(--bg3);border-bottom:1px solid var(--bdr)}
th{padding:9px 14px;text-align:left;font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);letter-spacing:.7px;text-transform:uppercase;white-space:nowrap}
td{padding:10px 14px;font-size:12px;color:var(--text);border-bottom:1px solid rgba(30,45,71,.4);vertical-align:middle}
tbody tr:last-child td{border-bottom:none}
tbody tr:hover{background:rgba(255,255,255,.015)}
.mono{font-family:'DM Mono',monospace;font-size:10px;color:var(--dim)}

/* â”€â”€â”€ DEAL FORM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.form-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
.ff{display:flex;flex-direction:column;gap:4px}
.ff label{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);text-transform:uppercase;letter-spacing:.6px}
.ff input,.ff select{
  padding:9px 12px;
  background:var(--bg3);
  border:1px solid var(--bdr2);
  border-radius:7px;
  font-family:'DM Sans',sans-serif;
  font-size:13px;
  color:var(--white);
  outline:none;
  transition:border-color .15s,box-shadow .15s;
  width:100%;
  -webkit-appearance:none;
}
.ff input:focus,.ff select:focus{border-color:var(--blue);box-shadow:0 0 0 2px rgba(27,110,243,.15)}
.ff select option{background:var(--bg3);color:var(--white)}
.ff .hint{font-size:9px;color:var(--muted)}

.preset-row{display:flex;align-items:stretch;gap:8px;flex-wrap:wrap}
.preset-btn{
  padding:9px 14px;border-radius:8px;cursor:pointer;
  background:var(--surf2);border:1px solid var(--bdr2);
  font-family:'DM Sans',sans-serif;font-size:11px;color:var(--dim);
  transition:all .15s;text-align:left;line-height:1.5;
}
.preset-btn:hover{color:var(--white);border-color:var(--blue2);background:var(--bdim)}
.preset-btn strong{display:block;color:var(--white);font-size:12px;margin-bottom:2px}

.run-btn{
  padding:11px 24px;
  background:linear-gradient(135deg,var(--blue),var(--teal));
  border:none;border-radius:9px;
  font-family:'Syne',sans-serif;font-size:13px;font-weight:700;color:#fff;
  cursor:pointer;transition:opacity .15s,transform .1s;
  display:inline-flex;align-items:center;gap:8px;
}
.run-btn:hover{opacity:.88;transform:translateY(-1px)}

/* â”€â”€â”€ HOWTO BANNER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.howto-banner{
  background:linear-gradient(135deg,rgba(27,110,243,.08),rgba(6,182,212,.04));
  border:1px solid rgba(27,110,243,.25);
  border-radius:var(--rl);padding:16px 18px;
}
.howto-title{font-family:'Syne',sans-serif;font-size:13px;font-weight:700;color:var(--white);margin-bottom:10px;display:flex;align-items:center;gap:7px}
.howto-steps{display:grid;grid-template-columns:repeat(5,1fr);gap:8px}
.howto-step{background:rgba(255,255,255,.03);border:1px solid var(--bdr);border-radius:9px;padding:10px 12px}
.howto-step-num{font-family:'DM Mono',monospace;font-size:9px;color:var(--blue2);background:var(--bdim);border:1px solid rgba(59,130,246,.2);width:20px;height:20px;border-radius:50%;display:flex;align-items:center;justify-content:center;margin-bottom:6px}
.howto-step-title{font-size:11px;font-weight:600;color:var(--white);margin-bottom:2px}
.howto-step-desc{font-size:10px;color:var(--dim);line-height:1.4}

/* â”€â”€â”€ ARCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.arch-col{display:flex;flex-direction:column;align-items:center;gap:0}
.arch-node{background:var(--surf2);border:1px solid var(--bdr2);border-radius:var(--r);padding:11px 14px;width:100%;display:flex;align-items:center;gap:10px}
.arch-node.hl{border-color:rgba(27,110,243,.5);background:rgba(27,110,243,.07)}
.arch-node.tl{border-color:rgba(6,182,212,.5);background:rgba(6,182,212,.07)}
.arch-node-emoji{font-size:18px;flex-shrink:0}
.arch-node-title{font-family:'Syne',sans-serif;font-size:12px;font-weight:700;color:var(--white)}
.arch-node-sub{font-size:10px;color:var(--dim);margin-top:1px}
.arch-arr{width:2px;height:16px;background:linear-gradient(180deg,var(--bdr2),var(--blue));margin:0 auto;position:relative}
.arch-arr::after{content:'â–¼';position:absolute;bottom:-7px;left:50%;transform:translateX(-50%);font-size:7px;color:var(--blue2)}
.agents-row{display:flex;gap:6px;margin-top:8px}
.agent-box{flex:1;background:var(--bg3);border:1px solid rgba(27,110,243,.3);border-radius:7px;padding:7px 8px;text-align:center}
.agent-box-num{font-family:'DM Mono',monospace;font-size:8px;color:var(--blue2);margin-bottom:2px}
.agent-box-name{font-size:10px;font-weight:600;color:var(--white)}
.agent-box-desc{font-size:9px;color:var(--dim);margin-top:1px}

/* â”€â”€â”€ FORMULA BOX â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.formula-box{background:var(--bg3);border:1px solid var(--bdr);border-radius:8px;padding:14px;font-family:'DM Mono',monospace;font-size:11px;color:var(--text);line-height:1.9;white-space:pre-wrap}
.f-comment{color:var(--muted)}.f-hi{color:var(--teal)}.f-key{color:var(--amber)}

/* â”€â”€â”€ THRESHOLDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.thr-list{display:flex;flex-direction:column;gap:6px}
.thr{display:flex;align-items:center;justify-content:space-between;padding:7px 12px;border-radius:7px}
.thr-g{background:var(--gdim);border:1px solid rgba(16,185,129,.2)}
.thr-b{background:var(--bdim);border:1px solid rgba(27,110,243,.2)}
.thr-a{background:var(--adim);border:1px solid rgba(245,158,11,.2)}
.thr-r{background:var(--rdim);border:1px solid rgba(239,68,68,.2)}
.thr-lbl{font-size:12px;font-weight:600}
.thr-lbl.g{color:var(--green)}.thr-lbl.b{color:var(--blue2)}.thr-lbl.a{color:var(--amber)}.thr-lbl.r{color:var(--red)}
.thr-rng{font-family:'DM Mono',monospace;font-size:10px;color:var(--dim)}

/* â”€â”€â”€ AGENT CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.agent-card{background:var(--surf2);border:1px solid var(--bdr2);border-radius:var(--rl);overflow:hidden;transition:border-color .4s,box-shadow .4s}
.agent-card.processing{border-color:var(--amber)}
.agent-card.done-low{border-color:var(--green);box-shadow:0 0 16px rgba(16,185,129,.1)}
.agent-card.done-mid{border-color:var(--amber);box-shadow:0 0 16px rgba(245,158,11,.1)}
.agent-card.done-high{border-color:var(--red);box-shadow:0 0 16px rgba(239,68,68,.1)}
.agent-hd{padding:11px 14px;background:var(--bg3);border-bottom:1px solid var(--bdr);display:flex;align-items:center;justify-content:space-between;gap:8px}
.agent-name{font-family:'Syne',sans-serif;font-size:12px;font-weight:700;color:var(--white)}
.agent-role{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);margin-top:1px}
.agent-body{padding:13px 14px}
.agent-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:7px}
.agent-row-lbl{font-family:'DM Mono',monospace;font-size:9px;color:var(--dim)}
.agent-row-val{font-family:'DM Mono',monospace;font-size:12px;font-weight:500;color:var(--white)}
.bar-wrap{margin:6px 0}
.bar-bg{height:4px;background:var(--bdr);border-radius:3px;overflow:hidden}
.bar-fill{height:4px;border-radius:3px;transition:width 1.2s cubic-bezier(.4,0,.2,1);width:0%}
.bf-g{background:linear-gradient(90deg,var(--green),var(--teal))}
.bf-a{background:linear-gradient(90deg,var(--amber),#F97316)}
.bf-r{background:linear-gradient(90deg,var(--red),#DB2777)}
.reasoning-box{margin-top:8px;padding:9px 11px;background:rgba(5,8,14,.5);border-radius:7px;font-size:11px;color:var(--dim);line-height:1.5;border-left:2px solid var(--blue)}

/* â”€â”€â”€ PROC BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.proc-bar{display:flex;align-items:center;gap:7px;padding:11px 15px;border-radius:8px;background:var(--adim);border:1px solid rgba(245,158,11,.3);font-family:'DM Mono',monospace;font-size:11px;color:var(--amber)}

/* â”€â”€â”€ CHAIR CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.chair-card{background:var(--surf);border:1px solid rgba(6,182,212,.35);border-radius:var(--rl);overflow:hidden;display:none;animation:fadeUp .3s ease}
.chair-hd{padding:12px 18px;background:linear-gradient(90deg,rgba(27,110,243,.08),rgba(6,182,212,.04));border-bottom:1px solid var(--bdr);display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
.chair-weights{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;padding:14px 18px}
.cw-box{text-align:center;padding:12px;background:var(--bg3);border:1px solid var(--bdr);border-radius:8px}
.cw-label{font-family:'DM Mono',monospace;font-size:8px;color:var(--muted);margin-bottom:5px;letter-spacing:.4px;text-transform:uppercase}
.cw-val{font-family:'Syne',sans-serif;font-size:22px;font-weight:800;color:var(--white)}
.chair-final{margin:0 18px 18px;padding:12px 16px;background:var(--bg);border-radius:8px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px}
.cf-lbl{font-family:'DM Mono',monospace;font-size:8px;color:var(--muted);margin-bottom:3px}
.cf-score{font-family:'Syne',sans-serif;font-size:26px;font-weight:800;color:var(--white)}
.cf-band{font-family:'Syne',sans-serif;font-size:14px;font-weight:700}

/* â”€â”€â”€ VERDICT PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.verdict-panel{background:var(--surf);border:1px solid var(--bdr);border-radius:var(--rl);overflow:hidden}
.verdict-hd{padding:16px 20px;border-bottom:1px solid var(--bdr);display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
.verdict-label{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);margin-bottom:3px}
.verdict-text{font-family:'Syne',sans-serif;font-size:18px;font-weight:800;letter-spacing:-.3px}
.vt-g{color:var(--green)}.vt-a{color:var(--amber)}.vt-r{color:var(--red)}
.gov-tag{padding:4px 12px;border-radius:6px;font-family:'DM Mono',monospace;font-size:9px;font-weight:500}
.gov-auto{background:var(--gdim);color:var(--green);border:1px solid rgba(16,185,129,.25)}
.gov-guard{background:var(--adim);color:var(--amber);border:1px solid rgba(245,158,11,.25)}
.gov-esc{background:var(--rdim);color:var(--red);border:1px solid rgba(239,68,68,.25)}
.score-section{display:flex;align-items:center;gap:18px;padding:16px 20px;border-bottom:1px solid var(--bdr)}
.score-ring{width:80px;height:80px;border-radius:50%;border:3px solid var(--bdr2);display:flex;flex-direction:column;align-items:center;justify-content:center;flex-shrink:0;transition:all .5s}
.score-ring-val{font-family:'Syne',sans-serif;font-size:22px;font-weight:800;color:var(--white)}
.score-ring-label{font-family:'DM Mono',monospace;font-size:7px;color:var(--muted);letter-spacing:.4px}
.score-bars{flex:1;display:flex;flex-direction:column;gap:8px;min-width:0}
.sb-row{display:flex;align-items:center;gap:8px}
.sb-lbl{font-family:'DM Mono',monospace;font-size:9px;color:var(--dim);width:180px;flex-shrink:0}
.sb-bar-wrap{flex:1;height:5px;background:var(--bdr);border-radius:3px;overflow:hidden}
.sb-bar{height:5px;border-radius:3px;width:0%;transition:width 1s ease}
.sb-val{font-family:'DM Mono',monospace;font-size:10px;color:var(--white);width:32px;text-align:right;flex-shrink:0}
.expl-box{padding:14px 20px;border-bottom:1px solid var(--bdr)}
.expl-lbl{font-family:'DM Mono',monospace;font-size:8px;color:var(--muted);letter-spacing:.8px;text-transform:uppercase;margin-bottom:5px}
.expl-text{font-size:12px;color:var(--text);line-height:1.6}
.decision-actions{padding:13px 20px;display:flex;gap:8px;flex-wrap:wrap}

/* â”€â”€â”€ AUDIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.audit-wrap{padding:14px 18px;display:flex;flex-direction:column;gap:0}
.audit-row{display:flex;gap:12px;padding:10px 0;border-bottom:1px solid rgba(30,45,71,.35)}
.audit-row:last-child{border-bottom:none}
.audit-dot{width:9px;height:9px;border-radius:50%;flex-shrink:0;margin-top:3px}
.audit-title{font-size:12px;font-weight:600;color:var(--white);margin-bottom:2px}
.audit-detail{font-size:11px;color:var(--dim);line-height:1.5}
.audit-time{font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);margin-top:2px}

/* â”€â”€â”€ RULE ROWS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.rule-active{background:rgba(27,110,243,.05)}
.rule-inactive td{opacity:.45}

/* â”€â”€â”€ GOVERNANCE ROWS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.gov-row{display:flex;align-items:center;justify-content:space-between;padding:9px 12px;border-bottom:1px solid rgba(30,45,71,.35)}
.gov-row:last-child{border-bottom:none}
.gov-row-lbl{font-size:12px;color:var(--text)}
.gov-row-val{font-family:'DM Mono',monospace;font-size:11px}

/* â”€â”€â”€ ESCALATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.esc-alert{background:var(--rdim);border:1px solid rgba(239,68,68,.3);border-radius:var(--rl);padding:14px 18px;display:flex;align-items:flex-start;gap:12px}
.esc-title{font-family:'Syne',sans-serif;font-size:13px;font-weight:700;color:var(--red);margin-bottom:3px}
.esc-detail{font-size:12px;color:var(--text);line-height:1.5}
.ov-area{width:100%;padding:9px 12px;background:var(--bg3);border:1px solid var(--bdr2);border-radius:7px;font-family:'DM Sans',sans-serif;font-size:12px;color:var(--white);outline:none;resize:none;transition:border-color .15s}
.ov-area:focus{border-color:var(--blue)}

/* â”€â”€â”€ IMPACT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.impact-banner{background:linear-gradient(135deg,rgba(27,110,243,.07),rgba(6,182,212,.04),rgba(16,185,129,.03));border:1px solid rgba(27,110,243,.2);border-radius:var(--rl);padding:24px 28px;text-align:center}
.impact-title{font-family:'Syne',sans-serif;font-size:18px;font-weight:800;color:var(--white);margin-bottom:6px}
.impact-formula{font-family:'DM Mono',monospace;font-size:12px;color:var(--teal);margin-bottom:12px}
.impact-desc{font-size:12px;color:var(--text);max-width:560px;margin:0 auto;line-height:1.7}
.impact-badges{display:flex;justify-content:center;gap:7px;flex-wrap:wrap;margin-top:14px}

/* â”€â”€â”€ WAIT STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.wait-state{text-align:center;padding:48px 20px;color:var(--dim)}
.ws-icon{font-size:32px;margin-bottom:10px}
.ws-title{font-family:'Syne',sans-serif;font-size:15px;color:var(--white);margin-bottom:5px}
.ws-desc{font-size:12px}
.ws-btn{margin-top:14px;padding:8px 20px;background:var(--bdim);border:1px solid rgba(59,130,246,.25);border-radius:7px;cursor:pointer;font-size:12px;color:var(--blue2);transition:all .15s;display:inline-block}
.ws-btn:hover{background:var(--blue);color:#fff}

/* â”€â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#toast{position:fixed;bottom:20px;right:20px;z-index:9999;background:var(--surf2);border:1px solid var(--bdr2);border-radius:10px;padding:11px 16px;font-size:12px;max-width:280px;box-shadow:0 8px 28px rgba(0,0,0,.5);display:none}
#toast.show{display:block;animation:fadeUp .25s ease}

/* â”€â”€â”€ TUTORIAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#tutorial{display:none;position:fixed;inset:0;z-index:1000;background:rgba(5,8,14,.9);backdrop-filter:blur(12px);align-items:center;justify-content:center}
#tutorial.open{display:flex}
.tut-box{background:var(--surf);border:1px solid var(--bdr2);border-radius:16px;padding:28px 32px;max-width:600px;width:94%;animation:popIn .25s ease}
@keyframes popIn{from{opacity:0;transform:scale(.96)}to{opacity:1;transform:scale(1)}}
.tut-title{font-family:'Syne',sans-serif;font-size:20px;font-weight:800;color:var(--white);margin-bottom:5px}
.tut-sub{font-size:12px;color:var(--dim);margin-bottom:20px}
.tut-steps{display:flex;flex-direction:column;gap:10px;margin-bottom:20px}
.tut-step{display:flex;gap:12px;align-items:flex-start;padding:12px 14px;background:var(--surf2);border:1px solid var(--bdr2);border-radius:10px}
.tut-num{width:26px;height:26px;border-radius:50%;flex-shrink:0;background:linear-gradient(135deg,var(--blue),var(--teal));display:flex;align-items:center;justify-content:center;font-family:'DM Mono',monospace;font-size:10px;color:#fff}
.tut-step-title{font-size:13px;font-weight:600;color:var(--white);margin-bottom:2px}
.tut-step-desc{font-size:11px;color:var(--dim);line-height:1.5}
.tut-close{width:100%;padding:11px;background:linear-gradient(135deg,var(--blue),var(--teal));border:none;border-radius:9px;font-family:'Syne',sans-serif;font-size:13px;font-weight:700;color:#fff;cursor:pointer;transition:opacity .15s}
.tut-close:hover{opacity:.88}

/* â”€â”€â”€ CHATBOT PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#chat-panel{
  position:fixed;top:54px;right:0;bottom:0;
  width:360px;
  background:var(--bg2);
  border-left:1px solid var(--bdr);
  display:flex;flex-direction:column;
  z-index:150;
  transform:translateX(100%);
  transition:transform .3s cubic-bezier(.4,0,.2,1);
}
#chat-panel.open{transform:translateX(0)}
.chat-hd{padding:13px 16px;border-bottom:1px solid var(--bdr);display:flex;align-items:center;justify-content:space-between;background:var(--bg3);flex-shrink:0}
.chat-avatar{width:30px;height:30px;background:linear-gradient(135deg,var(--blue),var(--teal));border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0}
.chat-hd-title{font-family:'Syne',sans-serif;font-size:13px;font-weight:700;color:var(--white)}
.chat-hd-sub{font-family:'DM Mono',monospace;font-size:8px;color:var(--muted);margin-top:1px}
.chat-close{width:24px;height:24px;background:var(--surf2);border:1px solid var(--bdr2);border-radius:5px;cursor:pointer;font-size:12px;color:var(--dim);display:flex;align-items:center;justify-content:center;transition:all .15s}
.chat-close:hover{background:var(--rdim);color:var(--red)}
.chat-ctx{padding:6px 14px;background:var(--bdim);border-bottom:1px solid rgba(27,110,243,.2);font-family:'DM Mono',monospace;font-size:8px;color:var(--blue2);flex-shrink:0}
.quick-chips{padding:8px 12px;border-bottom:1px solid var(--bdr);display:flex;gap:5px;flex-wrap:wrap;flex-shrink:0}
.chip{padding:3px 9px;border-radius:100px;cursor:pointer;background:var(--surf2);border:1px solid var(--bdr2);font-family:'DM Mono',monospace;font-size:8px;color:var(--dim);transition:all .15s;white-space:nowrap}
.chip:hover{color:var(--blue2);border-color:rgba(59,130,246,.4);background:var(--bdim)}
.chat-msgs{flex:1;overflow-y:auto;padding:14px 12px;display:flex;flex-direction:column;gap:12px}
.msg{display:flex;gap:7px;animation:fadeUp .2s ease}
.msg.user{flex-direction:row-reverse}
.msg-av{width:26px;height:26px;border-radius:6px;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:12px}
.msg.ai .msg-av{background:linear-gradient(135deg,var(--blue),var(--teal))}
.msg.user .msg-av{background:var(--surf2);border:1px solid var(--bdr2)}
.msg-bbl{max-width:84%;padding:9px 12px;border-radius:10px;font-size:12px;line-height:1.6}
.msg.ai .msg-bbl{background:var(--surf);border:1px solid var(--bdr);color:var(--text);border-top-left-radius:2px}
.msg.user .msg-bbl{background:linear-gradient(135deg,var(--blue),#1558C9);color:#fff;border-top-right-radius:2px}
.msg-time{font-family:'DM Mono',monospace;font-size:8px;color:var(--muted);margin-top:2px;text-align:center}
.typing span{width:5px;height:5px;background:var(--muted);border-radius:50%;display:inline-block;animation:tdot 1.4s infinite ease-in-out;margin:0 1px}
.typing span:nth-child(2){animation-delay:.2s}
.typing span:nth-child(3){animation-delay:.4s}
@keyframes tdot{0%,80%,100%{transform:scale(.6);opacity:.4}40%{transform:scale(1);opacity:1}}
.chat-input-area{padding:10px 12px;border-top:1px solid var(--bdr);display:flex;gap:7px;align-items:flex-end;flex-shrink:0;background:var(--bg3)}
#chat-input{flex:1;padding:9px 12px;background:var(--surf2);border:1px solid var(--bdr2);border-radius:9px;font-family:'DM Sans',sans-serif;font-size:12px;color:var(--white);outline:none;resize:none;max-height:100px;line-height:1.5;transition:border-color .15s}
#chat-input:focus{border-color:var(--blue)}
#chat-input::placeholder{color:var(--muted)}
.send-btn{width:34px;height:34px;background:linear-gradient(135deg,var(--blue),var(--teal));border:none;border-radius:9px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0;transition:opacity .15s}
.send-btn:hover{opacity:.85}
.send-btn:disabled{opacity:.35;cursor:not-allowed}
</style>
</head>
<body>

<!-- TOPBAR -->
<div id="topbar">
  <div class="tb-brand">
    <div class="tb-logo">MIQ</div>
    <div>
      <div class="tb-name">MarginIQ</div>
      <div class="tb-sub">Enterprise AI Pricing Committee Â· v3.0 Â· SAP-Ready</div>
    </div>
  </div>
  <div class="tb-right">
    <button class="tb-btn" onclick="openTutorial()">â“ How to Use</button>
    <span style="font-family:'DM Mono',monospace;font-size:9px;color:var(--muted)">100 Deals Simulated</span>
    <div class="live-pill"><div class="live-dot"></div>AGENT ACTIVE</div>
    <button class="tb-btn tb-btn-ai" onclick="toggleChat()">ğŸ¤– Ask MarginAI â–¸</button>
  </div>
</div>

<!-- CHAT PANEL -->
<div id="chat-panel">
  <div class="chat-hd">
    <div style="display:flex;align-items:center;gap:9px">
      <div class="chat-avatar">ğŸ¤–</div>
      <div>
        <div class="chat-hd-title">MarginAI Assistant</div>
        <div class="chat-hd-sub">AI-POWERED Â· DEAL-AWARE Â· SAP CONTEXT</div>
      </div>
    </div>
    <div class="chat-close" onclick="toggleChat()">âœ•</div>
  </div>
  <div class="chat-ctx" id="chat-ctx">âš¡ No active deal â€” Ask me anything about MarginIQ</div>
  <div class="quick-chips">
    <div class="chip" onclick="quickSend('How does the scoring formula work?')">Scoring formula</div>
    <div class="chip" onclick="quickSend('What are the governance thresholds?')">Governance rules</div>
    <div class="chip" onclick="quickSend('Why would a deal get escalated?')">Escalation logic</div>
    <div class="chip" onclick="quickSend('What is the ROI of MarginIQ for SAP?')">SAP ROI</div>
    <div class="chip" onclick="quickSend('Explain the weighted scoring model in detail')">Weighted model</div>
    <div class="chip" onclick="quickSend('How does MarginIQ integrate with SAP modules?')">SAP integration</div>
  </div>
  <div class="chat-msgs" id="chat-msgs">
    <div class="msg ai">
      <div class="msg-av">ğŸ¤–</div>
      <div>
        <div class="msg-bbl">ğŸ‘‹ Hi! I'm <strong>MarginAI</strong> â€” your intelligent assistant for the MarginIQ pricing committee.<br><br>I can explain the multi-agent scoring, governance rules, SAP integration, or analyze any deal you run. Try a chip above or ask me anything!</div>
        <div class="msg-time">Now</div>
      </div>
    </div>
  </div>
  <div class="chat-input-area">
    <textarea id="chat-input" placeholder="Ask about deals, agents, governance, SAPâ€¦" rows="1" onkeydown="chatKey(event)" oninput="autoResize(this)"></textarea>
    <button class="send-btn" id="send-btn" onclick="sendChat()">â¤</button>
  </div>
</div>

<!-- APP SHELL -->
<div id="app">

  <!-- SIDEBAR -->
  <nav id="sidebar">
    <div class="sn-label">Overview</div>
    <div class="sn-item on" onclick="go('arch',this)">
      <span class="sn-icon">ğŸ—</span>Architecture<span class="sn-num">1</span>
    </div>

    <div class="sn-label">Live Demo â€” In Order</div>
    <div class="sn-item" onclick="go('deal',this)">
      <span class="sn-icon">ğŸ“</span>Step 1 Â· Deal Input<span class="sn-num">2</span>
    </div>
    <div class="sn-item" onclick="go('agents',this)">
      <span class="sn-icon">ğŸ§ </span>Step 2 Â· Agent Reasoning<span class="sn-num">3</span>
    </div>
    <div class="sn-item" onclick="go('decision',this)">
      <span class="sn-icon">âš–ï¸</span>Step 3 Â· Final Decision<span class="sn-num">4</span>
    </div>

    <div class="sn-label">Governance</div>
    <div class="sn-item" onclick="go('escalation',this)">
      <span class="sn-icon">ğŸš¨</span>Escalation Case<span class="sn-badge">1</span>
    </div>
    <div class="sn-item" onclick="go('audit',this)">
      <span class="sn-icon">ğŸ“‹</span>Audit Trail
    </div>

    <div class="sn-label">Analytics</div>
    <div class="sn-item" onclick="go('kpi',this)">
      <span class="sn-icon">ğŸ“Š</span>KPI Simulation
    </div>
    <div class="sn-item" onclick="go('transform',this)">
      <span class="sn-icon">âš¡</span>Enterprise Impact
    </div>
  </nav>

  <!-- MAIN CONTENT -->
  <main id="main">

<!-- â•â•â•â•â•â•â• SCREEN: ARCHITECTURE â•â•â•â•â•â•â• -->
<div id="s-arch" class="screen on">
  <div class="ph">
    <div>
      <div class="ph-title">System Architecture</div>
      <div class="ph-sub">Enterprise AI Co-Decision Framework for Discount Governance</div>
    </div>
    <span class="ph-tag">PHASE 0 + 1 Â· START HERE</span>
  </div>

  <div style="background:linear-gradient(135deg,rgba(27,110,243,.08),rgba(6,182,212,.04));border:1px solid rgba(27,110,243,.25);border-radius:var(--rl);padding:18px 22px;">
    <div style="font-family:'DM Mono',monospace;font-size:8px;color:var(--blue2);letter-spacing:1.2px;text-transform:uppercase;margin-bottom:6px;">ğŸ¯ Transformation Objective</div>
    <div style="font-family:'Syne',sans-serif;font-size:14px;font-weight:700;color:var(--white);line-height:1.5;max-width:780px;">"Redesign enterprise discount governance by delegating structured financial authority to AI agents operating under defined risk thresholds â€” enabling instant, explainable, audited commercial decisions at scale."</div>
    <div style="margin-top:10px;display:flex;gap:7px;flex-wrap:wrap;">
      <span class="badge bb">Human-Agent Enterprise</span>
      <span class="badge bg">Margin Protection</span>
      <span class="badge ba">Full Governance</span>
      <span class="badge bm">SAP-Ready</span>
    </div>
  </div>

  <div class="g2" style="align-items:start;">
    <!-- Left: Flow -->
    <div class="arch-col">
      <div style="font-family:'DM Mono',monospace;font-size:8px;color:var(--muted);letter-spacing:1px;text-transform:uppercase;margin-bottom:8px;align-self:flex-start;">System Flow</div>
      <div class="arch-node hl">
        <div class="arch-node-emoji">ğŸ“‹</div>
        <div><div class="arch-node-title">Sales Deal Input</div><div class="arch-node-sub">Discount request submitted via SAP SD</div></div>
      </div>
      <div class="arch-arr"></div>
      <div class="arch-node" style="background:rgba(27,110,243,.07);border-color:var(--blue);flex-direction:column;align-items:flex-start;gap:6px;">
        <div style="display:flex;align-items:center;gap:10px;width:100%">
          <div class="arch-node-emoji">ğŸ§ </div>
          <div><div class="arch-node-title">Multi-Agent Layer</div><div class="arch-node-sub">3 specialist agents run in parallel</div></div>
        </div>
        <div class="agents-row" style="width:100%;margin-top:0">
          <div class="agent-box"><div class="agent-box-num">AGENT 1</div><div class="agent-box-name">Procurement</div><div class="agent-box-desc">Margin integrity</div></div>
          <div class="agent-box" style="border-color:rgba(6,182,212,.35)"><div class="agent-box-num" style="color:var(--teal)">AGENT 2</div><div class="agent-box-name">Inventory</div><div class="agent-box-desc">Working capital</div></div>
          <div class="agent-box" style="border-color:rgba(16,185,129,.35)"><div class="agent-box-num" style="color:var(--green)">AGENT 3</div><div class="agent-box-name">Customer</div><div class="agent-box-desc">Strategic value</div></div>
        </div>
      </div>
      <div class="arch-arr"></div>
      <div class="arch-node tl">
        <div class="arch-node-emoji">âš–ï¸</div>
        <div><div class="arch-node-title">Revenue Optimization Agent</div><div class="arch-node-sub">Chairperson â€” aggregates weighted outputs</div></div>
      </div>
      <div class="arch-arr"></div>
      <div class="arch-node" style="border-color:var(--amber);">
        <div class="arch-node-emoji">ğŸ›</div>
        <div><div class="arch-node-title">Governance & Escalation Engine</div><div class="arch-node-sub">Authority matrix + guardrails enforced</div></div>
      </div>
      <div class="arch-arr"></div>
      <div class="arch-node hl">
        <div class="arch-node-emoji">ğŸ“Š</div>
        <div><div class="arch-node-title">Audit Log + KPI Dashboard</div><div class="arch-node-sub">Full traceability &amp; impact metrics</div></div>
      </div>
    </div>

    <!-- Right: Formula + Thresholds + SAP -->
    <div style="display:flex;flex-direction:column;gap:13px;">
      <div class="card">
        <div class="card-hd">
          <div class="card-title">Weighted Scoring Formula</div>
          <span class="badge bb">Chairperson Logic</span>
        </div>
        <div class="card-body">
          <div class="formula-box"><span class="f-comment">// Revenue Optimization Agent</span>
Final_Risk_Score =
  <span class="f-key">0.4</span> Ã— Margin_Risk_Score
  + <span class="f-key">0.3</span> Ã— Inventory_Pressure_Score
  + <span class="f-key">0.3</span> Ã— Customer_Value_Score

<span class="f-comment">// Decision Bands</span>
Score &lt; <span class="f-hi">0.35</span>  â†’  AUTO APPROVE
0.35 â€“ 0.65    â†’  APPROVE WITH GUARDRAIL
Score &gt; <span class="f-hi">0.65</span>  â†’  ESCALATE TO DIRECTOR</div>
        </div>
      </div>

      <div class="card">
        <div class="card-hd"><div class="card-title">Decision Thresholds</div></div>
        <div class="card-body">
          <div class="thr-list">
            <div class="thr thr-g"><span class="thr-lbl g">âœ“ Auto Approve</span><span class="thr-rng">CM% â‰¥ 15% Â· Score &lt; 0.35</span></div>
            <div class="thr thr-b"><span class="thr-lbl b">âš¡ Conditional</span><span class="thr-rng">CM% 10â€“15% Â· Score 0.35â€“0.65</span></div>
            <div class="thr thr-a"><span class="thr-lbl a">â¬† Escalate</span><span class="thr-rng">CM% &lt; 10% Â· Score &gt; 0.65</span></div>
            <div class="thr thr-r"><span class="thr-lbl r">âœ— Hard Block</span><span class="thr-rng">Discount &gt; 12% cap</span></div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-hd"><div class="card-title">SAP Integration Points</div><span class="badge bm">Enterprise-Ready</span></div>
        <div style="padding:0 0 4px;">
          <div class="gov-row"><span class="gov-row-lbl">SAP SD â€” Order-to-Cash</span><span class="gov-row-val" style="color:var(--green)">âœ“ Native API</span></div>
          <div class="gov-row"><span class="gov-row-lbl">SAP MM â€” Procurement Cost</span><span class="gov-row-val" style="color:var(--green)">âœ“ Real-time</span></div>
          <div class="gov-row"><span class="gov-row-lbl">SAP EWM â€” Inventory Age</span><span class="gov-row-val" style="color:var(--green)">âœ“ Live feed</span></div>
          <div class="gov-row"><span class="gov-row-lbl">SAP BW/4HANA Analytics</span><span class="gov-row-val" style="color:var(--green)">âœ“ Embedded</span></div>
          <div class="gov-row"><span class="gov-row-lbl">SAP GRC â€” Compliance</span><span class="gov-row-val" style="color:var(--amber)">âš¡ Phase 2</span></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â• SCREEN: DEAL INPUT â•â•â•â•â•â•â• -->
<div id="s-deal" class="screen">
  <div class="ph">
    <div>
      <div class="ph-title">Step 1 â€” Deal Input</div>
      <div class="ph-sub">Submit a discount request to the AI Pricing Committee</div>
    </div>
    <span class="ph-tag">PHASE 1 Â· TRIGGER</span>
  </div>

  <!-- How to use -->
  <div class="howto-banner">
    <div class="howto-title">ğŸ—º How to Use This Demo</div>
    <div class="howto-steps">
      <div class="howto-step">
        <div class="howto-step-num">1</div>
        <div class="howto-step-title">Load Preset</div>
        <div class="howto-step-desc">Pick Easy, Medium or Hard scenario</div>
      </div>
      <div class="howto-step">
        <div class="howto-step-num">2</div>
        <div class="howto-step-title">Submit Deal</div>
        <div class="howto-step-desc">Click "Run AI Pricing Committee"</div>
      </div>
      <div class="howto-step">
        <div class="howto-step-num">3</div>
        <div class="howto-step-title">Watch Agents</div>
        <div class="howto-step-desc">3 AI agents analyze in parallel</div>
      </div>
      <div class="howto-step">
        <div class="howto-step-num">4</div>
        <div class="howto-step-title">Get Verdict</div>
        <div class="howto-step-desc">See the explainable final decision</div>
      </div>
      <div class="howto-step">
        <div class="howto-step-num">5</div>
        <div class="howto-step-title">Ask MarginAI</div>
        <div class="howto-step-desc">Chat with AI about any decision</div>
      </div>
    </div>
  </div>

  <!-- Presets -->
  <div class="card">
    <div class="card-hd">
      <div class="card-title">Quick Scenarios â€” Load Pre-Built Test Cases</div>
      <span class="badge bm">Recommended for demo</span>
    </div>
    <div class="card-body">
      <div class="preset-row">
        <button class="preset-btn" onclick="loadPreset('easy')">
          <strong>âœ… Scenario A â€” Easy Approve</strong>
          Tier A Â· 4% discount Â· High margin Â· Auto-approved
        </button>
        <button class="preset-btn" onclick="loadPreset('medium')">
          <strong>âš  Scenario B â€” Borderline</strong>
          Tier B Â· 9% discount Â· Guardrail zone Â· Manager review
        </button>
        <button class="preset-btn" onclick="loadPreset('hard')">
          <strong>ğŸš¨ Scenario C â€” Escalation</strong>
          Tier C Â· 14% discount Â· Below margin floor Â· Director required
        </button>
      </div>
    </div>
  </div>

  <!-- Deal Form -->
  <div class="card">
    <div class="card-hd">
      <div class="card-title">Deal Parameters</div>
      <span id="deal-id-badge" class="badge bm">Awaiting submission</span>
    </div>
    <div class="card-body" style="display:flex;flex-direction:column;gap:16px;">

      <div class="form-grid">
        <div class="ff">
          <label>Customer Segment</label>
          <select id="f-seg">
            <option value="A">Tier A â€” Strategic Account</option>
            <option value="B">Tier B â€” Growth Account</option>
            <option value="C">Tier C â€” Standard Account</option>
          </select>
        </div>
        <div class="ff">
          <label>Requested Discount (%)</label>
          <input id="f-disc" type="number" value="5" min="0" max="25">
          <div class="hint">Hard cap: 12% Â· Above triggers escalation</div>
        </div>
        <div class="ff">
          <label>Order Value (â‚¹)</label>
          <input id="f-price" type="number" value="200000">
        </div>
        <div class="ff">
          <label>Procurement Cost (â‚¹)</label>
          <input id="f-proc" type="number" value="100000">
        </div>
        <div class="ff">
          <label>Logistics Cost (â‚¹)</label>
          <input id="f-log" type="number" value="10000">
        </div>
        <div class="ff">
          <label>Inventory Level (units)</label>
          <input id="f-invl" type="number" value="500">
        </div>
        <div class="ff">
          <label>Inventory Age (days)</label>
          <input id="f-inva" type="number" value="20">
          <div class="hint">&gt;60 days = pressure signal</div>
        </div>
        <div class="ff">
          <label>Competitor Price (â‚¹)</label>
          <input id="f-comp" type="number" value="195000">
        </div>
      </div>

      <div style="display:flex;align-items:center;gap:12px;padding-top:4px;">
        <button class="run-btn" onclick="runAgents()">ğŸ§  Run AI Pricing Committee â†’</button>
        <span style="font-size:11px;color:var(--muted)">Agents will fire in ~2.7 seconds</span>
      </div>

    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â• SCREEN: AGENT REASONING â•â•â•â•â•â•â• -->
<div id="s-agents" class="screen">
  <div class="ph">
    <div>
      <div class="ph-title">Step 2 â€” Agent Reasoning</div>
      <div class="ph-sub">3 specialist AI agents analyze the deal in parallel</div>
    </div>
    <span class="ph-tag">PHASE 2 + 3 Â· ANALYSIS</span>
  </div>

  <div id="agents-wait" class="wait-state">
    <div class="ws-icon">ğŸ§ </div>
    <div class="ws-title">Agents Standing By</div>
    <div class="ws-desc">Submit a deal first to activate the AI Pricing Committee.</div>
    <div class="ws-btn" onclick="go('deal',document.querySelectorAll('.sn-item')[1])">â†’ Go to Deal Input</div>
  </div>

  <div id="agents-out" style="display:none;flex-direction:column;gap:14px;">
    <div id="proc-bar" class="proc-bar">
      <div class="live-dot" style="background:var(--amber)"></div>
      Initializing agents...
    </div>

    <div class="g3">
      <!-- Agent 1 -->
      <div id="a1-card" class="agent-card processing">
        <div class="agent-hd">
          <div>
            <div class="agent-name">âš™ Procurement Cost Agent</div>
            <div class="agent-role">PHASE 2 Â· MARGIN INTEGRITY</div>
          </div>
          <span id="a1-badge" class="badge ba">Running...</span>
        </div>
        <div class="agent-body">
          <div class="agent-row"><span class="agent-row-lbl">Pre-Discount Margin</span><span id="a1-pre" class="agent-row-val">â€”</span></div>
          <div class="agent-row"><span class="agent-row-lbl">Post-Discount Margin</span><span id="a1-post" class="agent-row-val">â€”</span></div>
          <div class="bar-wrap"><div class="bar-bg"><div id="a1-bar" class="bar-fill"></div></div></div>
          <div class="agent-row"><span class="agent-row-lbl">Risk Assessment</span><span id="a1-risk">â€”</span></div>
          <div class="agent-row"><span class="agent-row-lbl">Safe Discount Range</span><span id="a1-safe" class="agent-row-val">â€”</span></div>
          <div class="reasoning-box" id="a1-reason">Analyzing procurement cost structure...</div>
        </div>
      </div>

      <!-- Agent 2 -->
      <div id="a2-card" class="agent-card processing">
        <div class="agent-hd">
          <div>
            <div class="agent-name">ğŸ“¦ Inventory Risk Agent</div>
            <div class="agent-role">PHASE 2 Â· WORKING CAPITAL</div>
          </div>
          <span id="a2-badge" class="badge ba">Running...</span>
        </div>
        <div class="agent-body">
          <div class="agent-row"><span class="agent-row-lbl">Stock Level</span><span id="a2-lvl" class="agent-row-val">â€”</span></div>
          <div class="agent-row"><span class="agent-row-lbl">Inventory Age</span><span id="a2-age" class="agent-row-val">â€”</span></div>
          <div class="bar-wrap"><div class="bar-bg"><div id="a2-bar" class="bar-fill"></div></div></div>
          <div class="agent-row"><span class="agent-row-lbl">Pressure Level</span><span id="a2-press">â€”</span></div>
          <div class="agent-row"><span class="agent-row-lbl">Discount Adjustment</span><span id="a2-adj" class="agent-row-val">â€”</span></div>
          <div class="reasoning-box" id="a2-reason">Evaluating inventory aging and stock levels...</div>
        </div>
      </div>

      <!-- Agent 3 -->
      <div id="a3-card" class="agent-card processing">
        <div class="agent-hd">
          <div>
            <div class="agent-name">ğŸ¤ Customer Value Agent</div>
            <div class="agent-role">PHASE 2 Â· STRATEGIC ALIGNMENT</div>
          </div>
          <span id="a3-badge" class="badge ba">Running...</span>
        </div>
        <div class="agent-body">
          <div class="agent-row"><span class="agent-row-lbl">Customer Segment</span><span id="a3-seg" class="agent-row-val">â€”</span></div>
          <div class="agent-row"><span class="agent-row-lbl">Policy Flexibility</span><span id="a3-flex" class="agent-row-val">â€”</span></div>
          <div class="bar-wrap"><div class="bar-bg"><div id="a3-bar" class="bar-fill"></div></div></div>
          <div class="agent-row"><span class="agent-row-lbl">Churn Risk</span><span id="a3-risk">â€”</span></div>
          <div class="agent-row"><span class="agent-row-lbl">Competitor Context</span><span id="a3-comp" class="agent-row-val" style="font-size:10px;max-width:120px;text-align:right;">â€”</span></div>
          <div class="reasoning-box" id="a3-reason">Assessing customer strategic value...</div>
        </div>
      </div>
    </div>

    <!-- Chairperson -->
    <div id="chair-card" class="chair-card">
      <div class="chair-hd">
        <div>
          <div style="font-family:'Syne',sans-serif;font-size:13px;font-weight:700;color:var(--white);">âš–ï¸ Revenue Optimization Agent (Chairperson)</div>
          <div style="font-family:'DM Mono',monospace;font-size:9px;color:var(--muted);margin-top:1px;">PHASE 3 Â· WEIGHTED AGGREGATION</div>
        </div>
        <span class="badge bb">Aggregating scores</span>
      </div>
      <div class="chair-weights">
        <div class="cw-box"><div class="cw-label">Margin Risk Ã— 0.4</div><div class="cw-val" id="cw1">â€”</div></div>
        <div class="cw-box"><div class="cw-label">Inventory Pressure Ã— 0.3</div><div class="cw-val" id="cw2">â€”</div></div>
        <div class="cw-box"><div class="cw-label">Customer Value Ã— 0.3</div><div class="cw-val" id="cw3">â€”</div></div>
      </div>
      <div class="chair-final">
        <div><div class="cf-lbl">FINAL WEIGHTED RISK SCORE</div><div class="cf-score" id="cf-score">â€”</div></div>
        <div class="cf-band" id="cf-band">â€”</div>
        <button class="btn btn-blue" onclick="go('decision',document.querySelectorAll('.sn-item')[3])">View Final Decision â†’</button>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â• SCREEN: FINAL DECISION â•â•â•â•â•â•â• -->
<div id="s-decision" class="screen">
  <div class="ph">
    <div>
      <div class="ph-title">Step 3 â€” Final Decision + Governance Tag</div>
      <div class="ph-sub">Explainable AI verdict with full delegated authority classification</div>
    </div>
    <span class="ph-tag">PHASE 4 + 5 Â· VERDICT</span>
  </div>

  <div id="dec-wait" class="wait-state">
    <div class="ws-icon">âš–ï¸</div>
    <div class="ws-title">Awaiting Agent Analysis</div>
    <div class="ws-desc">Complete Steps 1 and 2 first â€” submit a deal and let the agents process it.</div>
    <div class="ws-btn" onclick="go('deal',document.querySelectorAll('.sn-item')[1])">â†’ Go to Deal Input</div>
  </div>

  <div id="dec-out" style="display:none;flex-direction:column;gap:16px;">
    <div class="verdict-panel">
      <div class="verdict-hd">
        <div>
          <div class="verdict-label">DEAL <span id="dv-id">â€”</span> Â· AI PRICING COMMITTEE VERDICT</div>
          <div class="verdict-text" id="dv-text">â€”</div>
        </div>
        <div id="dv-gov">â€”</div>
      </div>
      <div class="score-section">
        <div class="score-ring" id="sr-ring">
          <div class="score-ring-val" id="sr-val">â€”</div>
          <div class="score-ring-label">RISK SCORE</div>
        </div>
        <div class="score-bars">
          <div class="sb-row"><div class="sb-lbl">Margin Risk (weight 0.4)</div><div class="sb-bar-wrap"><div class="sb-bar" id="sb1"></div></div><div class="sb-val" id="sv1">â€”</div></div>
          <div class="sb-row"><div class="sb-lbl">Inventory Pressure (weight 0.3)</div><div class="sb-bar-wrap"><div class="sb-bar" id="sb2"></div></div><div class="sb-val" id="sv2">â€”</div></div>
          <div class="sb-row"><div class="sb-lbl">Customer Value (weight 0.3)</div><div class="sb-bar-wrap"><div class="sb-bar" id="sb3"></div></div><div class="sb-val" id="sv3">â€”</div></div>
          <div style="height:1px;background:var(--bdr);margin:2px 0"></div>
          <div class="sb-row"><div class="sb-lbl" style="color:var(--white);font-weight:600;">Final Weighted Score</div><div class="sb-bar-wrap"><div class="sb-bar" id="sb-f"></div></div><div class="sb-val" id="sv-f" style="color:var(--white);font-weight:600;">â€”</div></div>
        </div>
      </div>
      <div class="expl-box">
        <div class="expl-lbl">ğŸ¤– AI Explanation â€” Why this decision was made</div>
        <div class="expl-text" id="dv-expl">â€”</div>
      </div>
      <div class="decision-actions" id="dv-actions"></div>
    </div>

    <div class="card">
      <div class="card-hd">
        <div class="card-title">ğŸ› Delegated Authority Matrix â€” Active Rule</div>
        <span class="badge bb">Phase 5 Â· Governance</span>
      </div>
      <div class="card-body np">
        <table>
          <thead><tr><th>Condition</th><th>Threshold</th><th>AI Authority</th><th>Human Role</th><th>Status</th></tr></thead>
          <tbody>
            <tr id="rule1"><td>High Confidence</td><td>Margin &gt; 15%</td><td><span class="badge bg">Fully Autonomous</span></td><td>Logged only</td><td id="rs1"><span class="badge bm">Inactive</span></td></tr>
            <tr id="rule2"><td>Guardrail Zone</td><td>Margin 10â€“15%</td><td><span class="badge ba">Autonomous + Log</span></td><td>Manager review 24h</td><td id="rs2"><span class="badge bm">Inactive</span></td></tr>
            <tr id="rule3"><td>Escalation Trigger</td><td>Margin &lt; 10%</td><td><span class="badge br">Escalate</span></td><td>Director approval</td><td id="rs3"><span class="badge bm">Inactive</span></td></tr>
            <tr id="rule4"><td>Hard Cap Violation</td><td>Discount &gt; 12%</td><td><span class="badge br">Mandatory Review</span></td><td>Human override only</td><td id="rs4"><span class="badge bm">Inactive</span></td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <div style="display:flex;justify-content:center;">
      <button class="btn btn-blue" onclick="openChat('Explain this decision in detail and what should the sales team do next?')">ğŸ¤– Ask MarginAI to Explain This Decision</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â• SCREEN: ESCALATION â•â•â•â•â•â•â• -->
<div id="s-escalation" class="screen">
  <div class="ph">
    <div>
      <div class="ph-title">Escalation Case â€” Director Review</div>
      <div class="ph-sub">High-risk deal flagged with dual trigger â€” mandatory human oversight</div>
    </div>
    <span class="ph-tag">PHASE 5 Â· GOVERNANCE</span>
  </div>

  <div class="esc-alert">
    <div style="font-size:20px;flex-shrink:0">ğŸš¨</div>
    <div>
      <div class="esc-title">ESCALATION TRIGGERED â€” Deal DL-ESC-0047</div>
      <div class="esc-detail">Tier C customer requesting <strong>14% discount</strong> on â‚¹2,40,000 order. Projected margin: <strong style="color:var(--red)">7.8%</strong> â€” below 10% floor. Discount exceeds 12% hard cap. <strong>Dual escalation rules triggered simultaneously.</strong></div>
    </div>
  </div>

  <div class="g2">
    <div class="card">
      <div class="card-hd"><div class="card-title">AI Reasoning Breakdown</div><span class="badge br">Risk Score: 0.81</span></div>
      <div class="card-body" style="display:flex;flex-direction:column;gap:0">
        <div class="agent-row" style="margin-bottom:8px"><span class="agent-row-lbl">Requested Discount</span><span class="agent-row-val" style="color:var(--red)">14%</span></div>
        <div class="agent-row" style="margin-bottom:8px"><span class="agent-row-lbl">Post-Discount Margin</span><span class="agent-row-val" style="color:var(--red)">7.8%</span></div>
        <div class="agent-row" style="margin-bottom:8px"><span class="agent-row-lbl">Inventory Age</span><span class="agent-row-val">82 days âš </span></div>
        <div class="agent-row" style="margin-bottom:8px"><span class="agent-row-lbl">Customer Segment</span><span class="agent-row-val">Tier C (0% flex)</span></div>
        <div class="agent-row" style="margin-bottom:8px"><span class="agent-row-lbl">Final Risk Score</span><span class="agent-row-val" style="color:var(--red)">0.81 â€” HIGH</span></div>
        <div class="bar-wrap"><div class="bar-bg"><div class="bar-fill bf-r" style="width:81%"></div></div></div>
        <div class="expl-box" style="margin-top:10px">
          <div class="expl-lbl">ğŸ¤– AI Explanation</div>
          <div class="expl-text">"Escalated because projected margin of 7.8% falls below the 10% minimum threshold AND discount of 14% exceeds the 12% hard cap. Dual governance rules triggered. Despite inventory aging pressure, margin protection takes precedence. Director review mandatory."</div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-hd"><div class="card-title">Director Review Panel</div><span class="badge br">Action Required</span></div>
      <div class="card-body" style="display:flex;flex-direction:column;gap:12px">
        <div class="ff">
          <label>Override Justification (Required for Audit)</label>
          <textarea id="ov-reason" class="ov-area" rows="3" placeholder="Enter reason for your decision â€” permanently logged to audit trail..."></textarea>
        </div>
        <div class="ff">
          <label>Counter Offer Discount (%) â€” if applicable</label>
          <input id="ov-counter" type="number" value="8" min="0" max="15">
        </div>
        <div style="display:flex;flex-direction:column;gap:7px">
          <button class="btn btn-g" style="width:100%;justify-content:center" onclick="handleOv('approve')">âœ“ Approve with Director Override Authority</button>
          <button class="btn btn-a" style="width:100%;justify-content:center" onclick="handleOv('counter')">â†© Send Counter Offer to Sales</button>
          <button class="btn btn-r" style="width:100%;justify-content:center" onclick="handleOv('reject')">âœ— Final Reject â€” Below Margin Floor</button>
        </div>
        <div id="ov-result" style="display:none"></div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-hd"><div class="card-title">Live Audit Trail â€” Deal DL-ESC-0047</div><span class="badge ba">Updating Live</span></div>
    <div class="audit-wrap">
      <div class="audit-row"><div class="audit-dot" style="background:var(--blue)"></div><div><div class="audit-title">Deal Submitted by Sales â€” APAC Region</div><div class="audit-detail">Tier C customer requested 14% discount on â‚¹2,40,000 PO. Auto-routed to AI Pricing Committee.</div><div class="audit-time">Today Â· 10:14 AM Â· Sales Rep: A. Sharma</div></div></div>
      <div class="audit-row"><div class="audit-dot" style="background:var(--blue2)"></div><div><div class="audit-title">Multi-Agent Analysis Completed in 1.2 seconds</div><div class="audit-detail">Agent 1: HIGH margin risk (7.8%). Agent 2: MEDIUM inventory pressure (82-day aging). Agent 3: ZERO flexibility (Tier C). Final risk score: 0.81.</div><div class="audit-time">Today Â· 10:14 AM Â· MarginIQ v3.0</div></div></div>
      <div class="audit-row"><div class="audit-dot" style="background:var(--red)"></div><div><div class="audit-title">ğŸš¨ Dual Escalation Rules Triggered</div><div class="audit-detail">Rule 3: Margin 7.8% &lt; 10% minimum. Rule 4: Discount 14% &gt; 12% hard cap. Director notification dispatched.</div><div class="audit-time">Today Â· 10:14 AM Â· Governance Engine</div></div></div>
      <div class="audit-row" id="ov-audit-row" style="display:none"><div class="audit-dot" id="ov-audit-dot" style="background:var(--amber)"></div><div><div class="audit-title" id="ov-audit-title">â€”</div><div class="audit-detail" id="ov-audit-detail">â€”</div><div class="audit-time" id="ov-audit-time">â€”</div></div></div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â• SCREEN: AUDIT TRAIL â•â•â•â•â•â•â• -->
<div id="s-audit" class="screen">
  <div class="ph">
    <div>
      <div class="ph-title">Immutable Audit Trail</div>
      <div class="ph-sub">Every AI and human decision is permanently logged with timestamp, reasoning, and outcome</div>
    </div>
    <span class="ph-tag">GOVERNANCE Â· ACCOUNTABILITY</span>
  </div>

  <div class="g4">
    <div class="kpi"><div class="kpi-lbl">Total Decisions</div><div class="kpi-val">247</div><div class="kpi-dt up">â–² 47 today</div></div>
    <div class="kpi g"><div class="kpi-lbl">Auto Approved</div><div class="kpi-val">173</div><div class="kpi-dt up">70% auto-rate</div></div>
    <div class="kpi a"><div class="kpi-lbl">Conditional</div><div class="kpi-val">50</div><div class="kpi-dt neu">20% flagged</div></div>
    <div class="kpi r"><div class="kpi-lbl">Escalated</div><div class="kpi-val">24</div><div class="kpi-dt neu">10% escalated</div></div>
  </div>

  <div class="card">
    <div class="card-hd"><div class="card-title">Decision Log â€” Last 6 Events</div><span class="badge bm">Immutable Â· Tamper-proof</span></div>
    <div class="audit-wrap">
      <div class="audit-row"><div class="audit-dot" style="background:var(--green)"></div><div><div class="audit-title">AUTO APPROVED â€” DL-2024-0892 Â· Tier A Â· 5% Discount</div><div class="audit-detail">Margin 16.8% â†’ above 15% floor. Risk score 0.22 â€” LOW. Fully autonomous. Sales notified instantly.</div><div class="audit-time">Today Â· 11:55 AM Â· MarginIQ v3.0</div></div></div>
      <div class="audit-row"><div class="audit-dot" style="background:var(--amber)"></div><div><div class="audit-title">CONDITIONAL APPROVE â€” DL-2024-0891 Â· Tier B Â· 9% Discount</div><div class="audit-detail">Margin 11.4% â†’ guardrail zone. Risk score 0.48 â€” MEDIUM. Manager R. Kapoor notified for 24h review.</div><div class="audit-time">Today Â· 11:32 AM Â· MarginIQ v3.0</div></div></div>
      <div class="audit-row"><div class="audit-dot" style="background:var(--red)"></div><div><div class="audit-title">ESCALATED â€” DL-ESC-0047 Â· Tier C Â· 14% Discount</div><div class="audit-detail">Dual trigger: Margin 7.8% &lt; 10% floor + Discount &gt; 12% cap. Score 0.81 â€” HIGH. Director escalation sent.</div><div class="audit-time">Today Â· 10:14 AM Â· Governance Engine</div></div></div>
      <div class="audit-row"><div class="audit-dot" style="background:var(--green)"></div><div><div class="audit-title">AUTO APPROVED â€” DL-2024-0887 Â· Tier A Â· 3% Discount</div><div class="audit-detail">Margin 22.1% â€” well above all thresholds. Risk score 0.18. Zero human time consumed.</div><div class="audit-time">Today Â· 09:47 AM Â· MarginIQ v3.0</div></div></div>
      <div class="audit-row"><div class="audit-dot" style="background:var(--amber)"></div><div><div class="audit-title">HUMAN OVERRIDE â€” DL-2024-0879 Â· Dir. R. Patel</div><div class="audit-detail">Counter-offer 6% approved. Reason: "Strategic account retention priority Q4 â€” commercial exception."</div><div class="audit-time">Yesterday Â· 02:10 PM Â· Dir. R. Patel</div></div></div>
      <div class="audit-row"><div class="audit-dot" style="background:var(--green)"></div><div><div class="audit-title">AUTO APPROVED â€” DL-2024-0884 Â· Tier B Â· 7% Discount</div><div class="audit-detail">Margin 17.3% â†’ above 15% floor. Score 0.28 â€” LOW. Total sales cycle: 47 seconds.</div><div class="audit-time">Yesterday Â· 04:22 PM Â· MarginIQ v3.0</div></div></div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â• SCREEN: KPI â•â•â•â•â•â•â• -->
<div id="s-kpi" class="screen">
  <div class="ph">
    <div>
      <div class="ph-title">KPI Simulation â€” 100 Deals</div>
      <div class="ph-sub">Simulated portfolio-level performance across all deal scenarios</div>
    </div>
    <span class="ph-tag">ANALYTICS Â· PORTFOLIO VIEW</span>
  </div>

  <div class="g4">
    <div class="kpi g"><div class="kpi-lbl">Avg Decision Time</div><div class="kpi-val">1.4s</div><div class="kpi-dt up">vs 3â€“5 days manual</div></div>
    <div class="kpi"><div class="kpi-lbl">Avg Margin Protected</div><div class="kpi-val">17.3%</div><div class="kpi-dt up">â–² +2.1pp vs baseline</div></div>
    <div class="kpi a"><div class="kpi-lbl">Unnecessary Discounts</div><div class="kpi-val">12</div><div class="kpi-dt dn">â–¼ â€“73% vs manual</div></div>
    <div class="kpi r"><div class="kpi-lbl">Over-discount Risk</div><div class="kpi-val">4</div><div class="kpi-dt dn">â–¼ â€“89% caught early</div></div>
  </div>

  <div class="g2">
    <div class="card">
      <div class="card-hd"><div class="card-title">Decision Distribution â€” 100 Deals</div></div>
      <div class="card-body" style="display:flex;flex-direction:column;gap:12px">
        <div>
          <div style="display:flex;justify-content:space-between;margin-bottom:4px"><span style="font-size:11px;color:var(--green)">âœ… Auto Approved (70)</span><span style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted)">70%</span></div>
          <div class="bar-bg"><div class="bar-fill bf-g" style="width:70%"></div></div>
        </div>
        <div>
          <div style="display:flex;justify-content:space-between;margin-bottom:4px"><span style="font-size:11px;color:var(--amber)">âš  Conditional (20)</span><span style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted)">20%</span></div>
          <div class="bar-bg"><div class="bar-fill bf-a" style="width:20%"></div></div>
        </div>
        <div>
          <div style="display:flex;justify-content:space-between;margin-bottom:4px"><span style="font-size:11px;color:var(--red)">ğŸš¨ Escalated (10)</span><span style="font-family:'DM Mono',monospace;font-size:10px;color:var(--muted)">10%</span></div>
          <div class="bar-bg"><div class="bar-fill bf-r" style="width:10%"></div></div>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-hd"><div class="card-title">Business Impact Summary</div></div>
      <div class="card-body">
        <div class="g2" style="gap:10px">
          <div style="text-align:center;padding:14px;background:var(--bg3);border-radius:9px;border:1px solid var(--bdr)">
            <div style="font-family:'DM Mono',monospace;font-size:8px;color:var(--muted);margin-bottom:5px">ANNUAL MARGIN SAVED</div>
            <div style="font-family:'Syne',sans-serif;font-size:22px;font-weight:800;color:var(--green)">â‚¹2.1Cr</div>
            <div style="font-size:10px;color:var(--dim);margin-top:3px">preventing over-discounting</div>
          </div>
          <div style="text-align:center;padding:14px;background:var(--bg3);border-radius:9px;border:1px solid var(--bdr)">
            <div style="font-family:'DM Mono',monospace;font-size:8px;color:var(--muted);margin-bottom:5px">MANAGER HOURS FREED</div>
            <div style="font-family:'Syne',sans-serif;font-size:22px;font-weight:800;color:var(--blue2)">1,200</div>
            <div style="font-size:10px;color:var(--dim);margin-top:3px">hrs/year from manual review</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-hd"><div class="card-title">Simulated Deal Portfolio â€” Sample 12 Deals</div></div>
    <div class="card-body np">
      <table>
        <thead><tr><th>Deal ID</th><th>Segment</th><th>Discount</th><th>Margin</th><th>Risk Score</th><th>Decision</th></tr></thead>
        <tbody id="kpi-table"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â• SCREEN: ENTERPRISE IMPACT â•â•â•â•â•â•â• -->
<div id="s-transform" class="screen">
  <div class="ph">
    <div>
      <div class="ph-title">Enterprise Impact â€” Why MarginIQ</div>
      <div class="ph-sub">The business case for AI-powered discount governance at scale</div>
    </div>
    <span class="ph-tag">EXECUTIVE SUMMARY</span>
  </div>

  <div class="impact-banner">
    <div class="impact-title">From Approval Bottleneck to Instant Governance</div>
    <div class="impact-formula">3â€“5 day manual process â†’ 1.4 second AI decision</div>
    <div class="impact-desc">MarginIQ replaces ad-hoc discount approvals with a structured, explainable multi-agent system that protects margins, enforces governance, and frees human capital for strategic decisions â€” while maintaining full auditability.</div>
    <div class="impact-badges">
      <span class="badge bg">â‚¹2.1Cr Margin Saved/Year</span>
      <span class="badge bb">1,200 Manager Hours Freed</span>
      <span class="badge ba">100% Audit Coverage</span>
      <span class="badge bm">SAP-Native Integration</span>
    </div>
  </div>

  <div class="g3">
    <div class="kpi g"><div class="kpi-lbl">Cycle Time Reduction</div><div class="kpi-val">99.9%</div><div class="kpi-dt up">Days â†’ Seconds</div></div>
    <div class="kpi"><div class="kpi-lbl">Margin Improvement</div><div class="kpi-val">+2.1pp</div><div class="kpi-dt up">Portfolio average</div></div>
    <div class="kpi a"><div class="kpi-lbl">Governance Coverage</div><div class="kpi-val">100%</div><div class="kpi-dt up">Zero unaudited deals</div></div>
  </div>

  <div class="g2">
    <div class="card">
      <div class="card-hd"><div class="card-title">Before MarginIQ</div><span class="badge br">Manual Process</span></div>
      <div style="padding:0 0 4px">
        <div class="gov-row"><span class="gov-row-lbl">Approval cycle time</span><span class="gov-row-val" style="color:var(--red)">3â€“5 business days</span></div>
        <div class="gov-row"><span class="gov-row-lbl">Decision consistency</span><span class="gov-row-val" style="color:var(--red)">Ad-hoc, variable</span></div>
        <div class="gov-row"><span class="gov-row-lbl">Audit trail</span><span class="gov-row-val" style="color:var(--red)">Partial / email chains</span></div>
        <div class="gov-row"><span class="gov-row-lbl">Manager time per deal</span><span class="gov-row-val" style="color:var(--red)">45â€“90 minutes</span></div>
        <div class="gov-row"><span class="gov-row-lbl">Over-discount incidents</span><span class="gov-row-val" style="color:var(--red)">~18% of deals</span></div>
      </div>
    </div>
    <div class="card">
      <div class="card-hd"><div class="card-title">After MarginIQ</div><span class="badge bg">AI-Governed</span></div>
      <div style="padding:0 0 4px">
        <div class="gov-row"><span class="gov-row-lbl">Approval cycle time</span><span class="gov-row-val" style="color:var(--green)">1.4 seconds</span></div>
        <div class="gov-row"><span class="gov-row-lbl">Decision consistency</span><span class="gov-row-val" style="color:var(--green)">100% rule-based, explainable</span></div>
        <div class="gov-row"><span class="gov-row-lbl">Audit trail</span><span class="gov-row-val" style="color:var(--green)">Immutable, timestamped</span></div>
        <div class="gov-row"><span class="gov-row-lbl">Manager time per deal</span><span class="gov-row-val" style="color:var(--green)">0 min (70% of deals)</span></div>
        <div class="gov-row"><span class="gov-row-lbl">Over-discount incidents</span><span class="gov-row-val" style="color:var(--green)">~2% (caught by AI)</span></div>
      </div>
    </div>
  </div>
</div>

  </main>
</div><!-- end #app -->

<!-- TUTORIAL OVERLAY -->
<div id="tutorial">
  <div class="tut-box">
    <div class="tut-title">ğŸš€ Welcome to MarginIQ v3.0</div>
    <div class="tut-sub">Enterprise AI Pricing Committee Â· SAP-Ready Demo Â· Follow these steps for the full experience</div>
    <div class="tut-steps">
      <div class="tut-step"><div class="tut-num">1</div><div><div class="tut-step-title">Start with Architecture</div><div class="tut-step-desc">Understand the 5-phase system flow, scoring formula, and governance thresholds.</div></div></div>
      <div class="tut-step"><div class="tut-num">2</div><div><div class="tut-step-title">Load Scenario C (Hard) â†’ Submit Deal</div><div class="tut-step-desc">Go to Step 1, load Scenario C, click "Run AI Pricing Committee" for the most dramatic demo.</div></div></div>
      <div class="tut-step"><div class="tut-num">3</div><div><div class="tut-step-title">Watch 3 Agents Analyze</div><div class="tut-step-desc">See real-time agent reasoning fire sequentially in Step 2 â€” Procurement, Inventory, Customer Value.</div></div></div>
      <div class="tut-step"><div class="tut-num">4</div><div><div class="tut-step-title">View Verdict + Ask MarginAI</div><div class="tut-step-desc">See the explainable final decision in Step 3, then click "Ask MarginAI" to chat with the AI about it.</div></div></div>
    </div>
    <button class="tut-close" onclick="document.getElementById('tutorial').classList.remove('open')">Got it â€” Start Demo</button>
  </div>
</div>

<div id="toast"></div>

<script>
/* â”€â”€â”€ NAVIGATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function go(id, el) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('on'));
  document.querySelectorAll('.sn-item').forEach(s => s.classList.remove('on'));
  document.getElementById('s-' + id).classList.add('on');
  if (el) el.classList.add('on');
  document.getElementById('main').scrollTop = 0;
}
function openTutorial() { document.getElementById('tutorial').classList.add('open'); }

/* â”€â”€â”€ KPI TABLE INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
(function() {
  const segs = ['A','A','A','B','B','B','B','C','C','C','A','B'];
  const discs = [3,5,4,7,9,8,10,12,14,11,6,9];
  const rows = segs.map((s,i) => {
    const d=discs[i], p=180000+i*10000, c=90000+i*5000, l=8000+i*500;
    const adj=p*(1-d/100), m=((adj-c-l)/adj)*100;
    const ms=m<10?.9:m<15?.55:.2, is=.35, cs=s==='A'?.2:s==='B'?.4:.7;
    const fs=.4*ms+.3*is+.3*cs;
    let dec,dc;
    if(d>12||m<10){dec='ğŸš¨ Escalated';dc='var(--red)'}
    else if(fs<.35){dec='âœ… Auto Approved';dc='var(--green)'}
    else{dec='âš  Conditional';dc='var(--amber)'}
    return `<tr><td class="mono">DL-SIM-${String(i+1).padStart(3,'0')}</td><td>Tier ${s}</td><td>${d}%</td><td style="color:${m<10?'var(--red)':m<15?'var(--amber)':'var(--green)'};">${m.toFixed(1)}%</td><td class="mono">${fs.toFixed(2)}</td><td style="color:${dc};">${dec}</td></tr>`;
  });
  document.getElementById('kpi-table').innerHTML = rows.join('');
})();

/* â”€â”€â”€ PRESETS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const PRESETS = {
  easy:   {seg:'A',disc:4, price:200000,proc:100000,log:10000,invl:500,inva:30, comp:195000},
  medium: {seg:'B',disc:9, price:180000,proc:95000, log:12000,invl:340,inva:45, comp:172000},
  hard:   {seg:'C',disc:14,price:240000,proc:140000,log:18000,invl:120,inva:82, comp:225000}
};
function loadPreset(k) {
  const p = PRESETS[k];
  ['seg','disc','price','proc','log','invl','inva','comp'].forEach(f => {
    document.getElementById('f-'+f).value = p[f];
  });
  toast({easy:'âœ… Scenario A loaded â€” Easy Approve', medium:'âš  Scenario B loaded â€” Borderline', hard:'ğŸš¨ Scenario C loaded â€” Escalation Case'}[k]);
}

/* â”€â”€â”€ AGENT LOGIC â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let CD = null;
function runAgents() {
  const seg  = document.getElementById('f-seg').value;
  const disc = parseFloat(document.getElementById('f-disc').value)||0;
  const price= parseFloat(document.getElementById('f-price').value)||0;
  const proc = parseFloat(document.getElementById('f-proc').value)||0;
  const log  = parseFloat(document.getElementById('f-log').value)||0;
  const invl = parseFloat(document.getElementById('f-invl').value)||0;
  const inva = parseFloat(document.getElementById('f-inva').value)||0;
  const comp = parseFloat(document.getElementById('f-comp').value)||0;

  const dealId = 'DL-'+Date.now().toString().slice(-6);
  document.getElementById('deal-id-badge').textContent = 'Deal ID: '+dealId;

  const adjRev    = price*(1-disc/100);
  const origMargin = ((price-proc-log)/price)*100;
  const margin    = ((adjRev-proc-log)/adjRev)*100;
  const ms = margin<10?.9:margin<15?.55:.2;
  const is = inva>60?.35:invl<150?.75:.3;
  const cs = seg==='A'?.2:seg==='B'?.4:.7;
  const fs = .4*ms+.3*is+.3*cs;

  CD = {dealId,seg,disc,price,proc,log,invl,inva,comp,margin,origMargin,ms,is,cs,fs};
  updateChatCtx();

  go('agents', document.querySelectorAll('.sn-item')[2]);

  document.getElementById('agents-wait').style.display = 'none';
  document.getElementById('agents-out').style.display = 'flex';
  document.getElementById('chair-card').style.display = 'none';

  ['a1','a2','a3'].forEach(id => {
    document.getElementById(id+'-card').className = 'agent-card processing';
    document.getElementById(id+'-badge').textContent = 'Running...';
    document.getElementById(id+'-badge').className = 'badge ba';
    document.getElementById(id+'-bar').style.width = '0%';
  });

  const pb = document.getElementById('proc-bar');
  pb.style.cssText = 'display:flex;align-items:center;gap:7px;padding:11px 15px;border-radius:8px;background:var(--adim);border:1px solid rgba(245,158,11,.3);font-family:"DM Mono",monospace;font-size:11px;color:var(--amber)';
  pb.innerHTML = '<div class="live-dot" style="background:var(--amber)"></div> AI Pricing Committee processing â€” 3 agents running in parallel...';

  // Agent 1 at 700ms
  setTimeout(() => {
    const safeMax = Math.max(0,Math.floor(origMargin-15));
    const risk   = ms>.6?'HIGH':ms>.35?'MEDIUM':'LOW';
    const bc = ms>.6?'br':ms>.35?'ba':'bg';
    const barC = ms>.6?'bf-r':ms>.35?'bf-a':'bf-g';
    document.getElementById('a1-pre').textContent   = origMargin.toFixed(1)+'%';
    document.getElementById('a1-post').textContent  = margin.toFixed(1)+'%';
    document.getElementById('a1-bar').className     = 'bar-fill '+barC;
    document.getElementById('a1-bar').style.width   = Math.min(99,margin*4)+'%';
    document.getElementById('a1-risk').innerHTML    = `<span class="badge ${bc}">${risk}</span>`;
    document.getElementById('a1-safe').textContent  = '0â€“'+safeMax+'% safe';
    document.getElementById('a1-reason').textContent = `Net margin after ${disc}% discount: ${margin.toFixed(1)}%. `+(risk==='LOW'?'Margin healthy above 15% â€” no constraint from cost side.':risk==='MEDIUM'?'Margin in guardrail zone (10â€“15%). Conditional approval possible.':'Margin below 10% floor â€” escalation required.');
    document.getElementById('a1-badge').textContent = 'âœ“ Done';
    document.getElementById('a1-badge').className   = 'badge bg';
    document.getElementById('a1-card').className    = 'agent-card done-'+(ms>.6?'high':ms>.35?'mid':'low');
  }, 700);

  // Agent 2 at 1300ms
  setTimeout(() => {
    let iScore, iAdj, iReason, iPressure;
    if (inva>60)      { iScore='MEDIUM'; iAdj='+2â€“3% encouraged'; iPressure=35; iReason=`Stock aged ${inva} days (>60-day threshold). Working capital pressure â€” AI recommends slight discount flexibility to accelerate inventory turnover.`; }
    else if (invl<150){ iScore='HIGH';   iAdj='â€“2% restriction';  iPressure=75; iReason=`Stock critically low at ${invl} units. Discount restriction applied to preserve inventory value and prevent stockout risk.`; }
    else              { iScore='LOW';    iAdj='Neutral';           iPressure=30; iReason=`Stock healthy at ${invl} units, aged ${inva} days. No inventory pressure â€” neutral adjustment applied.`; }
    const bc   = iScore==='HIGH'?'br':iScore==='MEDIUM'?'ba':'bg';
    const barC = iScore==='HIGH'?'bf-r':iScore==='MEDIUM'?'bf-a':'bf-g';
    document.getElementById('a2-lvl').textContent   = invl+' units';
    document.getElementById('a2-age').textContent   = inva+(inva>60?' days âš ':' days âœ“');
    document.getElementById('a2-bar').className     = 'bar-fill '+barC;
    document.getElementById('a2-bar').style.width   = iPressure+'%';
    document.getElementById('a2-press').innerHTML   = `<span class="badge ${bc}">${iScore}</span>`;
    document.getElementById('a2-adj').textContent   = iAdj;
    document.getElementById('a2-reason').textContent = iReason;
    document.getElementById('a2-badge').textContent = 'âœ“ Done';
    document.getElementById('a2-badge').className   = 'badge bg';
    document.getElementById('a2-card').className    = 'agent-card done-'+(iScore==='HIGH'?'high':iScore==='MEDIUM'?'mid':'low');
  }, 1300);

  // Agent 3 at 1900ms
  setTimeout(() => {
    const flexMap = {A:'+3%',B:'+1%',C:'0%'};
    const nameMap = {A:'Tier A â€” Strategic Account',B:'Tier B â€” Growth Account',C:'Tier C â€” Standard Account'};
    const cRisk  = seg==='A'?'LOW':seg==='B'?'MEDIUM':'HIGH';
    const bc     = cRisk==='LOW'?'bg':cRisk==='MEDIUM'?'ba':'br';
    const barC   = cRisk==='LOW'?'bf-g':cRisk==='MEDIUM'?'bf-a':'bf-r';
    const compDiff = ((comp-price)/price*100).toFixed(1);
    const compTxt  = parseFloat(compDiff)>0?`Competitor is ${compDiff}% cheaper â€” retention discount justified.`:'Pricing competitive vs market. No urgency to over-discount.';
    document.getElementById('a3-seg').textContent   = nameMap[seg];
    document.getElementById('a3-flex').textContent  = flexMap[seg]+' policy max';
    document.getElementById('a3-bar').className     = 'bar-fill '+barC;
    document.getElementById('a3-bar').style.width   = (cs*100)+'%';
    document.getElementById('a3-risk').innerHTML    = `<span class="badge ${bc}">${cRisk}</span>`;
    document.getElementById('a3-comp').textContent  = compTxt;
    document.getElementById('a3-reason').textContent = `${nameMap[seg]}: policy allows ${flexMap[seg]} flexibility. ${compTxt} Customer value score: ${cs.toFixed(2)}.`;
    document.getElementById('a3-badge').textContent = 'âœ“ Done';
    document.getElementById('a3-badge').className   = 'badge bg';
    document.getElementById('a3-card').className    = 'agent-card done-'+(cRisk==='LOW'?'low':cRisk==='MEDIUM'?'mid':'high');
  }, 1900);

  // Chairperson at 2700ms
  setTimeout(() => {
    pb.innerHTML = 'âœ… All agents complete â€” Chairperson aggregating weighted scores';
    pb.style.background = 'var(--gdim)';
    pb.style.color = 'var(--green)';
    pb.style.borderColor = 'rgba(16,185,129,.3)';

    let band, bandColor;
    if (fs<.35)      { band='âœ… LOW RISK â€” APPROVE';       bandColor='var(--green)'; }
    else if (fs<.65) { band='âš  MEDIUM RISK â€” CONDITIONAL'; bandColor='var(--amber)'; }
    else             { band='ğŸš¨ HIGH RISK â€” ESCALATE';     bandColor='var(--red)'; }

    document.getElementById('cw1').textContent = (.4*ms).toFixed(3);
    document.getElementById('cw2').textContent = (.3*is).toFixed(3);
    document.getElementById('cw3').textContent = (.3*cs).toFixed(3);
    document.getElementById('cf-score').textContent = fs.toFixed(3);
    document.getElementById('cf-score').style.color = bandColor;
    document.getElementById('cf-band').textContent  = band;
    document.getElementById('cf-band').style.color  = bandColor;
    document.getElementById('chair-card').style.display = 'block';
    populateDecision();
  }, 2700);
}

/* â”€â”€â”€ FINAL DECISION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function populateDecision() {
  if (!CD) return;
  const {dealId,disc,margin,ms,is,cs,fs} = CD;
  document.getElementById('dec-wait').style.display = 'none';
  document.getElementById('dec-out').style.display  = 'flex';

  let vText, vClass, govHTML, expl, activeRule;
  if (disc>12 || margin<10) {
    vText='ğŸš¨ ESCALATED â€” Director Approval Required'; vClass='vt-r';
    govHTML='<div class="gov-tag gov-esc">ğŸ› GOVERNANCE: Mandatory Human Review</div>';
    expl=`Escalated because ${margin<10?'projected margin of '+margin.toFixed(1)+'% falls below the 10% minimum threshold':''}${disc>12?(margin<10?' AND ':'')+' discount of '+disc+'% exceeds the 12% hard cap':''}. Full AI reasoning dispatched to Director.`;
    activeRule = margin<10?3:4;
  } else if (fs<.35) {
    vText='âœ… AUTO APPROVED â€” Fully Autonomous'; vClass='vt-g';
    govHTML='<div class="gov-tag gov-auto">âš¡ GOVERNANCE: Fully Autonomous</div>';
    expl=`Autonomously approved. Margin of ${margin.toFixed(1)}% is above the 15% threshold. Weighted risk score ${fs.toFixed(3)} falls in the LOW band. No human review required. Sales team notified instantly.`;
    activeRule=1;
  } else {
    vText='âš  CONDITIONALLY APPROVED â€” Manager Review'; vClass='vt-a';
    govHTML='<div class="gov-tag gov-guard">ğŸ“‹ GOVERNANCE: Autonomous + Logged</div>';
    expl=`Conditionally approved. Margin ${margin.toFixed(1)}% in guardrail zone (10â€“15%). Risk score ${fs.toFixed(3)} â€” MEDIUM band. Deal proceeds, manager must review within 24 hours.`;
    activeRule=2;
  }

  document.getElementById('dv-id').textContent   = dealId;
  document.getElementById('dv-text').innerHTML   = `<span class="${vClass}">${vText}</span>`;
  document.getElementById('dv-gov').innerHTML    = govHTML;
  document.getElementById('dv-expl').textContent = expl;

  const ringColor = fs<.35?'var(--green)':fs<.65?'var(--amber)':'var(--red)';
  const ring = document.getElementById('sr-ring');
  ring.style.borderColor = ringColor;
  ring.style.boxShadow   = `0 0 20px ${fs<.35?'rgba(16,185,129,.2)':fs<.65?'rgba(245,158,11,.2)':'rgba(239,68,68,.2)'}`;
  document.getElementById('sr-val').textContent  = fs.toFixed(2);

  const setBar = (id,valId,w,val,color) => {
    setTimeout(()=>{document.getElementById(id).style.width=w+'%';document.getElementById(id).style.background=color;},200);
    document.getElementById(valId).textContent=val;
  };
  setBar('sb1','sv1',ms*100,ms.toFixed(2),'var(--red)');
  setBar('sb2','sv2',is*100,is.toFixed(2),'var(--amber)');
  setBar('sb3','sv3',cs*100,cs.toFixed(2),'var(--blue2)');
  setBar('sb-f','sv-f',Math.min(100,fs*130),fs.toFixed(2),ringColor);

  [1,2,3,4].forEach(i => {
    const row = document.getElementById('rule'+i);
    row.className = i===activeRule?'rule-active':'rule-inactive';
    document.getElementById('rs'+i).innerHTML = i===activeRule?'<span class="badge bb">â–¶ ACTIVE</span>':'<span class="badge bm">Inactive</span>';
  });

  const acts = document.getElementById('dv-actions');
  if (activeRule===1) {
    acts.innerHTML=`<button class="btn btn-g" onclick="toast('âœ… Confirmed. Sales team notified.')">âœ“ Confirm & Notify Sales</button><button class="btn btn-ghost" onclick="toast('âœ… Logged to audit trail')">Log to Audit</button>`;
  } else if (activeRule===2) {
    acts.innerHTML=`<button class="btn btn-a" onclick="toast('âœ“ Manager notified. 24h review window.')">âœ“ Notify Manager for Review</button><button class="btn btn-ghost">Request Override</button>`;
  } else {
    acts.innerHTML=`<button class="btn btn-r" onclick="go('escalation',document.querySelectorAll('.sn-item')[4])">ğŸš¨ Open Escalation Panel â†’</button>`;
  }
}

/* â”€â”€â”€ ESCALATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function handleOv(action) {
  const reason  = document.getElementById('ov-reason').value || 'No reason provided.';
  const counter = document.getElementById('ov-counter').value;
  const now     = new Date().toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit'});
  const res     = document.getElementById('ov-result');

  const map = {
    approve:{msg:`<strong>âœ… Override Approved.</strong> Director authority exercised. Deal approved. Justification permanently logged. Sales notified immediately.`,bg:'var(--gdim)',border:'rgba(16,185,129,.3)',title:'DIRECTOR OVERRIDE â€” Approved',detail:`Director approved. Reason: "${reason}"`,dot:'var(--green)'},
    counter:{msg:`<strong>â†© Counter Offer Issued.</strong> Sales notified with revised offer of <strong>${counter}%</strong>. Director reasoning attached.`,bg:'var(--adim)',border:'rgba(245,158,11,.3)',title:'COUNTER OFFER ISSUED',detail:`Counter offer at ${counter}%. Original 14% declined. Reason: "${reason}"`,dot:'var(--amber)'},
    reject: {msg:`<strong>âœ— Final Rejection.</strong> Deal DL-ESC-0047 rejected. Margin of 7.8% deemed commercially unviable. Audit sealed.`,bg:'var(--rdim)',border:'rgba(239,68,68,.3)',title:'DIRECTOR REJECTED â€” Final',detail:`Margin below threshold. Reason: "${reason}"`,dot:'var(--red)'}
  };
  const m = map[action];
  res.style.cssText=`display:block;background:${m.bg};border:1px solid ${m.border};border-radius:8px;padding:12px 14px;line-height:1.6;color:var(--text);font-size:12px;margin-top:4px;`;
  res.innerHTML=m.msg;
  const ar=document.getElementById('ov-audit-row');
  ar.style.display='flex';
  document.getElementById('ov-audit-dot').style.background=m.dot;
  document.getElementById('ov-audit-title').textContent=m.title;
  document.getElementById('ov-audit-detail').textContent=m.detail;
  document.getElementById('ov-audit-time').textContent=`Today Â· ${now} Â· Director`;
  toast(action==='approve'?'âœ… Override logged':action==='counter'?'â†© Counter offer sent':'âœ— Rejection logged');
}

/* â”€â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function toast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3000);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AI CHATBOT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let chatHistory = [];
let chatOpen = false;

const SYSTEM_PROMPT = `You are MarginAI, the intelligent assistant embedded inside MarginIQ â€” an Enterprise AI Pricing Committee system built by an MBA student for SAP directors.

MarginIQ System:
- Multi-agent AI for enterprise discount governance in SAP environments
- 3 agents: Procurement Cost Agent (weight 0.4, checks margin integrity), Inventory Risk Agent (weight 0.3, checks working capital), Customer Value Agent (weight 0.3, checks strategic alignment)
- Chairperson formula: Final_Risk_Score = 0.4Ã—MarginRisk + 0.3Ã—InventoryPressure + 0.3Ã—CustomerValue
- Decision bands: <0.35 = AUTO APPROVE | 0.35-0.65 = CONDITIONAL (manager review 24h) | >0.65 = ESCALATE to Director
- Margin thresholds: >15% auto approve | 10-15% guardrail/conditional | <10% escalate
- Hard cap: discount >12% = mandatory director review regardless of score
- Customer tiers: A = Strategic (+3% flex), B = Growth (+1% flex), C = Standard (0% flex)
- SAP modules: SD (Order-to-Cash), MM (Procurement Cost), EWM (Inventory), BW/4HANA (Analytics), GRC (Phase 2)
- Business impact: 3-5 days â†’ 1.4 seconds | â‚¹2.1Cr margin saved/year | 1,200 manager hours freed | 100% audit coverage
- Full immutable audit trail, delegated authority matrix, escalation engine with Director override

Current deal: {DEAL_CONTEXT}

Respond in concise, confident MBA/business language suitable for SAP directors. Use numbers. No fluff. Max 4-5 sentences per response unless asked for detail.`;

function getDealContext() {
  if (!CD) return 'No active deal submitted yet.';
  const names = {A:'Tier A Strategic',B:'Tier B Growth',C:'Tier C Standard'};
  let v = CD.disc>12||CD.margin<10?'ESCALATED':CD.fs<.35?'AUTO APPROVED':'CONDITIONAL';
  return `Deal ${CD.dealId} | ${names[CD.seg]} | ${CD.disc}% discount | Margin: ${CD.margin.toFixed(1)}% | Scores: Margin=${CD.ms.toFixed(2)}, Inventory=${CD.is.toFixed(2)}, Customer=${CD.cs.toFixed(2)} | Final score: ${CD.fs.toFixed(3)} | Verdict: ${v}`;
}

function updateChatCtx() {
  const bar = document.getElementById('chat-ctx');
  if (CD) {
    let v = CD.disc>12||CD.margin<10?'ğŸš¨ ESCALATED':CD.fs<.35?'âœ… AUTO APPROVED':'âš  CONDITIONAL';
    bar.textContent = `âš¡ Active: ${CD.dealId} Â· ${CD.disc}% disc Â· ${CD.margin.toFixed(1)}% margin Â· ${v}`;
  } else {
    bar.textContent = 'âš¡ No active deal â€” Ask me anything about MarginIQ';
  }
}

function toggleChat() {
  chatOpen = !chatOpen;
  document.getElementById('chat-panel').classList.toggle('open', chatOpen);
  if (chatOpen) { updateChatCtx(); setTimeout(()=>document.getElementById('chat-input').focus(),350); }
}

function openChat(msg) {
  chatOpen = true;
  document.getElementById('chat-panel').classList.add('open');
  updateChatCtx();
  if (msg) setTimeout(()=>{ document.getElementById('chat-input').value=msg; sendChat(); },300);
  else setTimeout(()=>document.getElementById('chat-input').focus(),350);
}

function quickSend(msg) { document.getElementById('chat-input').value=msg; sendChat(); }

function autoResize(el) { el.style.height='auto'; el.style.height=Math.min(el.scrollHeight,100)+'px'; }

function chatKey(e) { if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendChat();} }

function addMsg(role, html) {
  const msgs = document.getElementById('chat-msgs');
  const now  = new Date().toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit'});
  const d    = document.createElement('div');
  d.className = 'msg '+role;
  d.innerHTML = `<div class="msg-av">${role==='ai'?'ğŸ¤–':'ğŸ‘¤'}</div><div><div class="msg-bbl">${html}</div><div class="msg-time">${now}</div></div>`;
  msgs.appendChild(d);
  msgs.scrollTop = msgs.scrollHeight;
  return d;
}

function addTyping() {
  const msgs = document.getElementById('chat-msgs');
  const d    = document.createElement('div');
  d.className = 'msg ai'; d.id = 'typing';
  d.innerHTML = `<div class="msg-av">ğŸ¤–</div><div><div class="msg-bbl"><div class="typing"><span></span><span></span><span></span></div></div></div>`;
  msgs.appendChild(d);
  msgs.scrollTop = msgs.scrollHeight;
}
function removeTyping() { const t=document.getElementById('typing'); if(t)t.remove(); }

function escHtml(s) { return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
function fmtReply(s) {
  return escHtml(s)
    .replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>')
    .replace(/\n\n/g,'<br><br>').replace(/\n/g,'<br>');
}

async function sendChat() {
  const inp = document.getElementById('chat-input');
  const msg = inp.value.trim();
  if (!msg) return;
  inp.value = ''; inp.style.height = 'auto';
  document.getElementById('send-btn').disabled = true;
  addMsg('user', escHtml(msg));
  chatHistory.push({role:'user',content:msg});
  addTyping();

  try {
    const sys = SYSTEM_PROMPT.replace('{DEAL_CONTEXT}', getDealContext());
    const resp = await fetch('https://api.anthropic.com/v1/messages', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({
        model:'claude-sonnet-4-20250514',
        max_tokens:800,
        system:sys,
        messages:chatHistory
      })
    });
    const data  = await resp.json();
    const reply = data.content?.[0]?.text || 'Sorry, something went wrong. Please try again.';
    chatHistory.push({role:'assistant',content:reply});
    removeTyping();
    addMsg('ai', fmtReply(reply));
  } catch(e) {
    removeTyping();
    addMsg('ai','âš  Connection error. Please try again.');
  }
  document.getElementById('send-btn').disabled = false;
  inp.focus();
  if (chatHistory.length>30) chatHistory=chatHistory.slice(-20);
}
</script>
</body>
</html>
